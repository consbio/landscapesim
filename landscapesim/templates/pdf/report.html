<!DOCTYPE html>
<html lang="en">
<head>
    <style type="text/css">
        @page {
            size: A4;
            margin: 0.5in;
        }

        table, tr, td, th, tbody, thead, tfoot {
            page-break-inside: avoid !important;
        }

        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            color: #333;
        }

        .new-page {
            page-break-before: always
        }

        .prevent-internal-break {
            page-break-inside: avoid !important;
        }

        .north-arrow {
            position: absolute;
            margin-top: -50px;
            margin-left: 5px;
            padding: 1px;
            background-color: rgba(255, 255, 255, .8);
            border-radius: 2px;
        }

        .scale-bar {
            position: absolute;
            margin-top: -22px;
            margin-left: 35px;
            padding: 2px 3px 1px 3px;
            background-color: rgba(255, 255, 255, .8);
            border-radius: 2px;
            font-size: 10px;
            font-weight: bold;
        }

        .scale-bar {
            display: inline-block;
            margin-right: 5px;
        }

        .map-table {
            width: 682px;
            border-spacing: 0px;
            border-collapse: collapse;
        }

        .map-table .west {
            font-size: 10px;
            border-left: 1px solid #000;
            padding-left: 2px;
        }

        .map-table .north {
            font-size: 10px;
            border-top: 1px solid #000;
            vertical-align: top;
            max-width: 15px;
            padding-top: 19px;
        }

        .map-table .north div {
            white-space: nowrap;
            transform: rotate(-90deg);
            -webkit-transform: rotate(-90deg);
            transform-origin: bottom right;
            -webkit-transform-origin: bottom right;
        }

        .map-table .image {
            border: 1px solid #000;
        }

        .map-table .image .map-image {
            margin-bottom: -4px;
        }

        .map-table .south {
            font-size: 10px;
            border-bottom: 1px solid #000;
            vertical-align: bottom;
            max-width: 15px;
            padding-left: 2px;
        }

        .map-table .south div {
            white-space: nowrap;
            transform: rotate(-90deg);
            -webkit-transform: rotate(-90deg);
            transform-origin: top left;
            -webkit-transform-origin: top left;
            margin-bottom: -8px;
        }

        .map-table .east {
            font-size: 10px;
            border-right: 1px solid #000;
            text-align: right;
            padding-top: 2px;
            padding-right: 2px;
        }

        h2 {
            text-align: center;
        }

        table.composition {
            width: 100%;
            border-spacing: 0px;
        }

        table.composition th {
            color: #555;
        }

        table.composition td {
            border-top: 1px solid #ddd;
            padding: 8px;
            max-width: 4in;
        }

        h3 {
            margin-bottom: 5px;
        }

        img.legend {
            transform: rotate(180deg);
            -webkit-transform: rotate(180deg);
        }

        span.summation {
            float: right;
        }

    </style>
</head>
<body>
<h2>Landscape Simulator Report - {{ today|date:"m/d/Y" }}</h2>
<div>&nbsp;</div>
<div><strong>ST-Sim Library:</strong> {{ library_name }}</div>
<div>&nbsp;</div>
<div><strong>Scenario:</strong> {{ scenario_name }}</div>
<div>&nbsp;</div>
<div><strong>Iterations:</strong> {{ num_iterations }}</div>
<div>&nbsp;</div>
<div><strong>Timesteps ({{ timestep_units }}) Per Iteration:</strong> {{ num_timesteps }}</div>
<div>&nbsp;</div>
<h3>Initial Vegetation Composition</h3>
<div>
    {% for veg in initial_veg_composition %}
        <div class="prevent-internal-break">
            <h4>{{ veg.name }}<span class="summation">Total Proportion of Landscape - {{ veg.proportion_of_landscape }}%</span></h4>
            <table class="composition">
                <thead>
                    <tr>
                        <th>State Class</th>
                        <th>Proportion of Landscape</th>
                    </tr>
                </thead>
                <tbody>
                {% for stateclass in veg.stateclasses %}
                    <tr>
                        <td>{{ stateclass.stateclass__name }}</td>
                        <td>{{ stateclass.relative_amount }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    {% endfor %}
</div>

<div class="new-page"></div>
<h3>Initial Conditions Spatial Distribution</h3>
<div>
    {% for config in initial_conditions_spatial %}
        <h4>{{ config.label }}</h4>
        <table class="map-table">
            <tbody>
                <tr>
                    <td></td>
                    <td class="west">{{ config.west|safe }}</td>
                    <td></td>
                </tr>
                <tr>
                    <td class="north"><div>{{ config.north|safe }}</div></td>
                    <td class="image">
                        <img class="map-image" src="data:image/png;base64,{{ config.image_data }}" />
                        <div class="north-arrow"><img src="data:image/png;base64,{{ north_image_data }}" /></div>
                        <div class="scale-bar"><img src="data:image/png;base64,{{ scale_image_data }}" /> {{ config.scale }}</div>
                    </td>
                    <td class="south"><div>{{ config.south|safe }}</div></td>
                </tr>
                <tr>
                    <td></td>
                    <td class="east">{{ config.east|safe }}</td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    {% endfor %}
</div>

{% if is_spatial %}
<div class="new-page"></div>
<h3>Model Results - Spatial Outputs</h3>
<div>
    {% for iteration in spatial_outputs %}
        <div>
            {% for time_config in iteration %}
            <div class="prevent-internal-break">
                <h4>{{ time_config.label }}</h4>
                <table class="map-table">
                    <tbody>
                        <tr>
                            <td></td>
                            <td class="west">{{ time_config.west|safe }}</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="north"><div>{{ time_config.north|safe }}</div></td>
                            <td class="image">
                                <img class="map-image" src="data:image/png;base64,{{ time_config.image_data }}" />
                                <div class="north-arrow"><img src="data:image/png;base64,{{ north_image_data }}" /></div>
                                <div class="scale-bar"><img src="data:image/png;base64,{{ scale_image_data }}" /> {{ time_config.scale }}</div>
                            </td>
                            <td class="south"><div>{{ time_config.south|safe }}</div></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td class="east">{{ time_config.east|safe }}</td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            {% endfor %}
        </div>
    {% endfor %}
</div>
{% endif %}

<div class="new-page"></div>
<h3>Model Results - Vegetation Change Over Time</h3>
<div>
    {% for pair in charts %}
        <div class="prevent-internal-break">
            <h4>{{ pair.name }}</h4>
            <table class="charts-table composition">
                <thead>
                    <tr>
                        <th>Vegetation Cover over {{ num_timesteps }} {{ timestep_units }}</th>
                        <th>Vegetation Cover in {{ num_timesteps }} {{ timestep_units }}</th>
                    </tr>
                </thead>
                <tbody>
                <tr>
                    <td>
                        <div>{{ pair.stacked|safe }}</div>
                    </td>
                    <td>
                        <div>{{ pair.column|safe }}</div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    {% endfor %}
</div>

<div class="new-page"></div>
<h3>Model Results - Vegetation Change Breakdown</h3>

</body>
</html>
